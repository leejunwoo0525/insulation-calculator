<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>단열재 추천 계산기</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .tab { display: none; }
    .tab.active { display: block; }
    button.tab-btn { margin-right: 10px; padding: 10px 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 6px 10px; text-align: center; }
    input, select { width: 140px; }
    .grade-A { background-color: #d4f8cc; }
    .grade-B { background-color: #fff8b2; }
    .grade-C { background-color: #ffe0b2; }
    .grade-D { background-color: #f8cccc; }
    #result { margin-top: 30px; }
  </style>
</head>
<body>

<h2>📦 단열재 추천 계산기</h2>
<div>
  <button class="tab-btn" onclick="switchTab('calculator')">계산기</button>
  <button class="tab-btn" onclick="switchTab('database')">단열재 목록</button>
</div>

<!-- 📐 계산기 탭 -->
<div id="calculator" class="tab active">
  <h3>📐 벽체 레이어 구성</h3>
  <table id="layerTable">
    <thead>
      <tr>
        <th>재료명</th>
        <th>두께 (mm)</th>
        <th>열전도율 λ</th>
        <th>열저항 R</th>
        <th>삭제</th>
      </tr>
    </thead>
    <tbody>
      <tr class="fixed-layer">
        <td><input type="text" value="실외 열전달저항" readonly /></td>
        <td><input type="number" value="0" readonly /></td>
        <td><input type="text" value="-" readonly /></td>
        <td><input type="number" value="0.043" readonly class="resistance" /></td>
        <td></td>
      </tr>
      <tr onclick="selectRow(this)">
        <td><input type="text" /></td>
        <td><input type="number" oninput="updateResistance(this)" /></td>
        <td><input type="number" oninput="updateResistance(this)" /></td>
        <td><input type="number" readonly class="resistance" /></td>
        <td><button onclick="removeRow(this)">삭제</button></td>
      </tr>
      <tr class="fixed-layer">
        <td><input type="text" value="실내 열전달저항" readonly /></td>
        <td><input type="number" value="0" readonly /></td>
        <td><input type="text" value="-" readonly /></td>
        <td><input type="number" value="0.11" readonly class="resistance" /></td>
        <td></td>
      </tr>
    </tbody>
  </table>
  <button onclick="addRow()">레이어 추가</button>

  <h4>단열재 두께 (mm): <input type="number" id="insulationThickness"></h4>
  <h4>지역: 
    <select id="region">
      <option value="중부1">중부1</option>
      <option value="중부2">중부2</option>
      <option value="남부">남부</option>
      <option value="제주">제주</option>
    </select>
    부위:
    <select id="zone">
      <option value="외벽">외벽</option>
      <option value="지붕">지붕</option>
      <option value="바닥">바닥</option>
    </select>
  </h4>
  <button onclick="calculate()">추천</button>
  <button onclick="window.print()">📄 PDF 저장</button>

  <div id="result"></div>
</div>

<!-- 📋 단열재 목록 탭 -->
<div id="database" class="tab">
  <h3>📋 단열재 목록</h3>
  <table id="insulationTable">
    <thead><tr><th>이름</th><th>λ</th><th>등급</th><th>가격</th></tr></thead>
    <tbody></tbody>
  </table>

  <h4>➕ 단열재 추가</h4>
  <input type="text" id="newName" placeholder="이름">
  <input type="number" id="newLambda" placeholder="λ (W/m·K)">
  <input type="text" id="newGrade" placeholder="등급">
  <input type="number" id="newPrice" placeholder="가격(원/㎡)">
  <button onclick="addCustomInsulation()">추가</button>
</div>

<script>
const uStandardTable = {
  '외벽': { '중부1': 0.15, '중부2': 0.17, '남부': 0.22, '제주': 0.29 },
  '지붕': { '중부1': 0.15, '중부2': 0.18, '남부': 0.25, '제주': 0.25 },
  '바닥': { '중부1': 0.15, '중부2': 0.17, '남부': 0.22, '제주': 0.29 }
};

let insulationList = [
  {name: "PF보드 A", lambda: 0.019, grade: "불연", price: 22000},
  {name: "경질우레탄 B", lambda: 0.025, grade: "준불연", price: 18000},
  {name: "XPS C", lambda: 0.034, grade: "난연", price: 11000}
];

function switchTab(id) {
  document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function updateResistance(input) {
  const row = input.closest("tr");
  const t = parseFloat(row.cells[1].querySelector('input').value) / 1000;
  const l = parseFloat(row.cells[2].querySelector('input').value);
  const R = row.cells[3].querySelector('input');
  if (!isNaN(t) && !isNaN(l) && l > 0) R.value = (t / l).toFixed(3);
  else R.value = '';
}

function addRow() {
  const tbody = document.querySelector("#layerTable tbody");
  const row = document.createElement("tr");
  row.setAttribute("onclick", "selectRow(this)");
  row.innerHTML = `
    <td><input type="text" /></td>
    <td><input type="number" oninput="updateResistance(this)" /></td>
    <td><input type="number" oninput="updateResistance(this)" /></td>
    <td><input type="number" readonly class="resistance" /></td>
    <td><button onclick="removeRow(this)">삭제</button></td>`;
  tbody.insertBefore(row, tbody.lastElementChild);
}

function removeRow(btn) {
  const row = btn.closest("tr");
  row.remove();
}

function selectRow(row) {
  document.querySelectorAll("#layerTable tr").forEach(r => r.classList.remove("selected"));
  row.classList.add("selected");
}

function updateInsulationTable() {
  const tbody = document.querySelector("#insulationTable tbody");
  tbody.innerHTML = "";
  for (const item of insulationList) {
    const row = `<tr><td>${item.name}</td><td>${item.lambda}</td><td>${item.grade}</td><td>${item.price}</td></tr>`;
    tbody.insertAdjacentHTML('beforeend', row);
  }
}

function addCustomInsulation() {
  const name = document.getElementById("newName").value;
  const lambda = parseFloat(document.getElementById("newLambda").value);
  const grade = document.getElementById("newGrade").value;
  const price = parseFloat(document.getElementById("newPrice").value);
  if (!name || isNaN(lambda)) {
    alert("이름과 λ를 정확히 입력하세요.");
    return;
  }
  insulationList.push({name, lambda, grade, price});
  updateInsulationTable();
}

function calculate() {
  const region = document.getElementById('region').value;
  const zone = document.getElementById('zone').value;
  const thickness = parseFloat(document.getElementById('insulationThickness').value) / 1000;

  let R_wall = 0;
  document.querySelectorAll(".resistance").forEach(r => {
    const val = parseFloat(r.value);
    if (!isNaN(val)) R_wall += val;
  });

  const U_target = uStandardTable[zone][region];
  const R_required = 1 / U_target;
  const R_needed = R_required - R_wall;
  const lambda_max = thickness / R_needed;

  const resultDiv = document.getElementById("result");
  resultDiv.innerHTML = `
    <p>📌 기준 열관류율: <b>${U_target} W/㎡·K</b></p>
    <p>🧮 현재 벽체 열관류율 (U): <b>${(1 / R_wall).toFixed(3)} W/㎡·K</b></p>
    <p>🎯 필요한 λ ≤ <b>${lambda_max.toFixed(3)} W/m·K</b></p>
    <h3>✅ 추천 단열재 (이름순)</h3>
  `;

  const ul = document.createElement("ul");
  insulationList
    .filter(ins => ins.lambda <= lambda_max)
    .sort((a, b) => a.name.localeCompare(b.name))
    .forEach(ins => {
      const li = document.createElement("li");
      li.textContent = `${ins.name} (λ=${ins.lambda}, ${ins.grade}, ${ins.price}원/㎡)`;
      li.className = getGradeClass(ins.lambda);
      ul.appendChild(li);
    });
  resultDiv.appendChild(ul);
}

function getGradeClass(lambda) {
  if (lambda <= 0.034) return 'grade-A';
  if (lambda <= 0.040) return 'grade-B';
  if (lambda <= 0.046) return 'grade-C';
  return 'grade-D';
}

updateInsulationTable();
</script>
</body>
</html>
