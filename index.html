<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë‹¨ì—´ì¬ ì¶”ì²œ ë° ì—´ê´€ë¥˜ìœ¨ ê³„ì‚°ê¸°</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    table { border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 6px 10px; text-align: center; }
    input, select { width: 140px; }
    button { margin: 10px 5px; padding: 6px 16px; }
    tr.selected { background-color: #e0f0ff; }
    #result { margin-top: 30px; }
  </style>
</head>
<body>
  <h2>ğŸ“¦ ë‹¨ì—´ì¬ ì¶”ì²œ ë° ì—´ê´€ë¥˜ìœ¨ ê³„ì‚°ê¸°</h2>

  <!-- ì§€ì—­, ë¶€ìœ„ ì„ íƒ -->
  <label>ì§€ì—­:
    <select id="region">
      <option value="ì¤‘ë¶€1">ì¤‘ë¶€1ì§€ì—­</option>
      <option value="ì¤‘ë¶€2">ì¤‘ë¶€2ì§€ì—­</option>
      <option value="ë‚¨ë¶€">ë‚¨ë¶€ì§€ì—­</option>
      <option value="ì œì£¼">ì œì£¼ë„</option>
    </select>
  </label>

  <label>ë¶€ìœ„:
    <select id="zone">
      <option value="ì™¸ë²½">ì™¸ë²½</option>
      <option value="ì§€ë¶•">ì§€ë¶•</option>
      <option value="ë°”ë‹¥">ë°”ë‹¥</option>
    </select>
  </label>

  <!-- ì¬ë£Œ ì„ íƒ UI -->
  <h3>ğŸ¯ ì ìš©í•  ì¬ë£Œ ì„ íƒ</h3>
  <select id="materialSelect" onchange="updateMaterialLambda()">
    <option value="">-- ì¬ë£Œ ì„ íƒ --</option>
    <option value="ì½˜í¬ë¦¬íŠ¸,1.6">ì½˜í¬ë¦¬íŠ¸</option>
    <option value="ì‹œë©˜íŠ¸ëª°íƒˆ,0.9">ì‹œë©˜íŠ¸ëª°íƒˆ</option>
    <option value="PFë³´ë“œ,0.021">PFë³´ë“œ</option>
    <option value="ìš°ë ˆíƒ„í¼,0.024">ìš°ë ˆíƒ„í¼</option>
    <option value="ë¹„ë“œë²•ë³´ì˜¨íŒ 1ì¢… 1í˜¸,0.037">ë¹„ë“œë²•ë³´ì˜¨íŒ 1ì¢… 1í˜¸</option>
  </select>
  <input type="text" id="lambdaValue" placeholder="Î» ìë™ì…ë ¥" readonly />
  <button onclick="applyMaterialToRow()">ì„ íƒ ë ˆì´ì–´ì— ì ìš©</button>

  <!-- ë²½ì²´ ë ˆì´ì–´ í…Œì´ë¸” -->
  <h3>ğŸ“ ë²½ì²´ ë ˆì´ì–´ êµ¬ì„±</h3>
  <table id="layerTable">
    <thead>
      <tr>
        <th>ì¬ë£Œëª…</th>
        <th>ë‘ê»˜ (mm)</th>
        <th>ì—´ì „ë„ìœ¨ Î»</th>
        <th>ì—´ì €í•­ R</th>
        <th>ì‚­ì œ</th>
      </tr>
    </thead>
    <tbody>
      <tr class="fixed-layer">
        <td><input type="text" value="ì‹¤ì™¸ ì—´ì „ë‹¬ì €í•­" readonly /></td>
        <td><input type="number" value="0" readonly /></td>
        <td><input type="text" value="-" readonly /></td>
        <td><input type="number" value="0.043" readonly class="resistance" /></td>
        <td></td>
      </tr>
      <tr onclick="selectRow(this)">
        <td><input type="text" /></td>
        <td><input type="number" oninput="updateResistance(this)" /></td>
        <td><input type="number" oninput="updateResistance(this)" /></td>
        <td><input type="number" readonly class="resistance" /></td>
        <td><button onclick="removeRow(this)">ì‚­ì œ</button></td>
      </tr>
      <tr class="fixed-layer">
        <td><input type="text" value="ì‹¤ë‚´ ì—´ì „ë‹¬ì €í•­" readonly /></td>
        <td><input type="number" value="0" readonly /></td>
        <td><input type="text" value="-" readonly /></td>
        <td><input type="number" value="0.11" readonly class="resistance" /></td>
        <td></td>
      </tr>
    </tbody>
  </table>

  <button onclick="addRow()">ë ˆì´ì–´ ì¶”ê°€</button>

  <!-- ë‹¨ì—´ì¬ ì •ë³´ -->
  <label>ë‹¨ì—´ì¬ ë‘ê»˜ (mm):</label>
  <input type="number" id="insulationThickness" />
  <button onclick="calculate()">ê³„ì‚° ë° ì¶”ì²œ</button>

  <div id="result"></div>

  <script>
    const uStandardTable = {
      'ì™¸ë²½': { 'ì¤‘ë¶€1': 0.15, 'ì¤‘ë¶€2': 0.17, 'ë‚¨ë¶€': 0.22, 'ì œì£¼': 0.29 },
      'ì§€ë¶•': { 'ì¤‘ë¶€1': 0.15, 'ì¤‘ë¶€2': 0.18, 'ë‚¨ë¶€': 0.25, 'ì œì£¼': 0.25 },
      'ë°”ë‹¥': { 'ì¤‘ë¶€1': 0.15, 'ì¤‘ë¶€2': 0.17, 'ë‚¨ë¶€': 0.22, 'ì œì£¼': 0.29 }
    };

    const insulationDB = {
      "PFë³´ë“œ": 0.021,
      "ìš°ë ˆíƒ„í¼": 0.024,
      "ë¹„ë“œë²•ë³´ì˜¨íŒ 1ì¢… 1í˜¸": 0.037
    };

    let selectedRow = null;

    function updateMaterialLambda() {
      const val = document.getElementById("materialSelect").value.split(",");
      document.getElementById("lambdaValue").value = val[1] || "";
    }

    function selectRow(row) {
      document.querySelectorAll("#layerTable tr").forEach(r => r.classList.remove("selected"));
      row.classList.add("selected");
      selectedRow = row;
    }

    function applyMaterialToRow() {
      if (!selectedRow) return alert("ë¨¼ì € ë ˆì´ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”.");
      const val = document.getElementById("materialSelect").value.split(",");
      if (val.length < 2) return alert("ì¬ë£Œë¥¼ ì„ íƒí•˜ì„¸ìš”.");
      selectedRow.cells[0].querySelector('input').value = val[0];
      selectedRow.cells[2].querySelector('input').value = val[1];
      updateResistance(selectedRow.cells[2].querySelector('input'));
    }

    function updateResistance(input) {
      const row = input.closest("tr");
      const t = parseFloat(row.cells[1].querySelector('input').value) / 1000;
      const l = parseFloat(row.cells[2].querySelector('input').value);
      const R = row.cells[3].querySelector('input');
      if (!isNaN(t) && !isNaN(l) && l > 0) R.value = (t / l).toFixed(3);
      else R.value = '';
      showUvalue();
    }

    function addRow() {
      const tbody = document.querySelector("#layerTable tbody");
      const row = document.createElement("tr");
      row.setAttribute("onclick", "selectRow(this)");
      row.innerHTML = `
        <td><input type="text" /></td>
        <td><input type="number" oninput="updateResistance(this)" /></td>
        <td><input type="number" oninput="updateResistance(this)" /></td>
        <td><input type="number" readonly class="resistance" /></td>
        <td><button onclick="removeRow(this)">ì‚­ì œ</button></td>`;
      tbody.insertBefore(row, tbody.lastElementChild);
    }

    function removeRow(btn) {
      const row = btn.closest("tr");
      row.remove();
      showUvalue();
    }

    function showUvalue() {
      const resistances = document.querySelectorAll(".resistance");
      let totalR = 0;
      resistances.forEach(r => {
        const val = parseFloat(r.value);
        if (!isNaN(val)) totalR += val;
      });

      const resultDiv = document.getElementById('result');
      if (totalR > 0) {
        resultDiv.innerHTML = `<p>ğŸ§® ë²½ì²´ ì „ì²´ ì—´ê´€ë¥˜ìœ¨ (U): <b>${(1 / totalR).toFixed(3)} W/ã¡Â·K</b></p>`;
      }
    }

    function calculate() {
      const region = document.getElementById('region').value;
      const zone = document.getElementById('zone').value;
      const thickness = parseFloat(document.getElementById('insulationThickness').value) / 1000;

      let R_wall = 0;
      document.querySelectorAll(".resistance").forEach(r => {
        const val = parseFloat(r.value);
        if (!isNaN(val)) R_wall += val;
      });

      const U_target = uStandardTable[zone][region];
      const R_required = 1 / U_target;
      const R_needed = R_required - R_wall;
      const lambda_max = thickness / R_needed;

      const candidates = Object.entries(insulationDB).filter(([_, lambda]) => lambda <= lambda_max);

      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = `
        <p>ğŸ“Œ ê¸°ì¤€ ì—´ê´€ë¥˜ìœ¨: <b>${U_target} W/ã¡Â·K</b></p>
        <p>ğŸ§® í˜„ì¬ ë²½ì²´ ì—´ê´€ë¥˜ìœ¨ (U): <b>${(1 / R_wall).toFixed(3)} W/ã¡Â·K</b></p>
        <p>ğŸ¯ í•„ìš”í•œ Î» â‰¤ <b>${lambda_max.toFixed(3)} W/mÂ·K</b></p>
      `;

      if (candidates.length === 0) {
        resultDiv.innerHTML += `<p>âŒ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ë‹¨ì—´ì¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
      } else {
        resultDiv.innerHTML += `<h3>âœ… ì¶”ì²œ ë‹¨ì—´ì¬</h3><ul>` +
          candidates.map(([name, lambda]) => `<li>${name} (Î»=${lambda})</li>`).join('') +
          `</ul>`;
      }
    }
  </script>
</body>
</html>
